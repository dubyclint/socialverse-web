# ============================================================================
# FILE: /.env.production
# ============================================================================
# Production environment variables for Zeabur deployment
# âœ… COMPLETE FIXED VERSION WITH ALL REQUIRED VARIABLES
# ============================================================================

# ============================================================================
# NODE ENVIRONMENT
# ============================================================================
NODE_ENV=production

# ============================================================================
# SERVER CONFIGURATION
# ============================================================================
PORT=8080
HOST=0.0.0.0

# ============================================================================
# APPLICATION CONFIGURATION
# ============================================================================
APP_NAME=SocialVerse
NUXT_PUBLIC_API_URL=https://socialverse-web.zeabur.app
NUXT_PUBLIC_SOCKET_URL=https://socialverse-web.zeabur.app
NUXT_PUBLIC_SITE_URL=https://socialverse-web.zeabur.app

# ============================================================================
# SUPABASE CONFIGURATION - PUBLIC (Client-side)
# ============================================================================
NUXT_PUBLIC_SUPABASE_URL=https://cvzrhucbvezqwbesthek.supabase.co
NUXT_PUBLIC_SUPABASE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN2enJodWNidmV6cXdiZXN0aGVrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkzNzgzMjYsImV4cCI6MjA3NDk1NDMyNn0.3k5QE5wTb0E52CqNxwt_HaU9jUGDlYsHWuP7rQVjY4I

# ============================================================================
# SUPABASE CONFIGURATION - SERVER-SIDE ONLY (Private)
# ============================================================================
SUPABASE_URL=https://cvzrhucbvezqwbesthek.supabase.co
SUPABASE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN2enJodWNidmV6cXdiZXN0aGVrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkzNzgzMjYsImV4cCI6MjA3NDk1NDMyNn0.3k5QE5wTb0E52CqNxwt_HaU9jUGDlYsHWuP7rQVjY4I
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN2enJodWNidmV6cXdiZXN0aGVrIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1OTM3ODMyNiwiZXhwIjoyMDc0OTU0MzI2fQ.4gjaVgOV9j_1PsVmylhwbqXnTm3zch6LmSsFFGeGMg

# ============================================================================
# CDN CONFIGURATION
# ============================================================================
# Set your CDN URL here (e.g., CloudFlare, AWS CloudFront, etc.)
# Leave empty to disable CDN
NUXT_PUBLIC_CDN_URL=
NUXT_PUBLIC_CDN_ENABLED=false

# ============================================================================
# GUN DATABASE CONFIGURATION
# ============================================================================
# Gun is disabled by default to prevent history.state errors
# Enable only if you have a Gun relay server configured
NUXT_PUBLIC_GUN_ENABLED=false
NUXT_PUBLIC_GUN_PEERS=

# ============================================================================
# AUTHENTICATION & SECURITY
# ============================================================================
JWT_SECRET=your-super-secret-jwt-key-change-in-production-min-32-chars
BREVO_API_KEY=your_brevo_api_key_here

# ============================================================================
# FEATURE FLAGS
# ============================================================================
NUXT_PUBLIC_ENABLE_PREMIUM=true
NUXT_PUBLIC_ENABLE_ANALYTICS=true

# ============================================================================
# LOGGING CONFIGURATION
# ============================================================================
LOG_LEVEL=info
DEBUG=false

# ============================================================================
# BUILD OPTIMIZATION FLAGS
# ============================================================================
ANALYZE=false

# ============================================================================
# SECURITY & PERFORMANCE
# ============================================================================
ENABLE_SECURITY_HEADERS=true
ENABLE_COMPRESSION=true
COMPRESSION_LEVEL=6
COMPRESSION_THRESHOLD=1024
Now let me provide the fixed plugins:

Dockerfile
// ============================================================================
// plugins/gun-client.ts - GUN DATABASE CLIENT PLUGIN (PROPERLY CONFIGURED)
// ============================================================================
// âœ… FIXED: Gun plugin now properly checks if enabled before loading
// This prevents "Cannot set property state" error when Gun is disabled

export default defineNuxtPlugin(() => {
  const config = useRuntimeConfig()
  const gunEnabled = config.public.gunEnabled
  const gunPeers = config.public.gunPeers || []

  if (!gunEnabled) {
    console.log('[Gun] Plugin loaded - GUN DISABLED (prevents History error)')
    
    // Return safe mock that does nothing
    const gunMock = {
      get: (key: string) => ({
        on: (callback: Function) => {},
        once: (callback: Function) => {},
        put: (data: any) => ({ on: () => {}, once: () => {} }),
      }),
      put: (data: any) => ({
        on: (callback: Function) => {},
        once: (callback: Function) => {},
      }),
      set: (data: any) => ({
        on: (callback: Function) => {},
        once: (callback: Function) => {},
      }),
      user: () => ({
        auth: (user: string, pass: string, callback: Function) => {
          callback({ err: 'Gun is disabled' })
        },
        leave: () => {},
      }),
    }

    return {
      provide: {
        gun: gunMock,
        gunEnabled: false,
      },
    }
  }

  // Gun is enabled - load the actual Gun library
  console.log('[Gun] Plugin loaded - GUN ENABLED')
  console.log('[Gun] Peers:', gunPeers.length > 0 ? gunPeers : 'Using default peers')

  try {
    // Dynamically import Gun only if enabled
    const Gun = require('gun')
    
    // Initialize Gun with configured peers
    const gunConfig: any = {}
    if (gunPeers.length > 0) {
      gunConfig.peers = gunPeers
    }
    
    const gun = Gun(gunConfig)
    
    console.log('[Gun] Successfully initialized')

    return {
      provide: {
        gun,
        gunEnabled: true,
      },
    }
  } catch (error) {
    console.error('[Gun] Failed to initialize:', error)
    
    // Fallback to mock
    const gunMock = {
      get: (key: string) => ({
        on: (callback: Function) => {},
        once: (callback: Function) => {},
        put: (data: any) => ({ on: () => {}, once: () => {} }),
      }),
      put: (data: any) => ({
        on: (callback: Function) => {},
        once: (callback: Function) => {},
      }),
      set: (data: any) => ({
        on: (callback: Function) => {},
        once: (callback: Function) => {},
      }),
    }

    return {
      provide: {
        gun: gunMock,
        gunEnabled: false,
      },
    }
  }
})
